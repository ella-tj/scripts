FROM alpine:latest

LABEL AUTHOR="none" \
      VERSION=0.1.4

ARG KEY="-----BEGIN OPENSSH PRIVATE KEY-----\n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\n-----END OPENSSH PRIVATE KEY-----"

ENV DEFAULT_LIST_FILE=crontab_list.sh \
    CUSTOM_LIST_MERGE_TYPE=append \
    COOKIES_LIST=/scripts/logs/cookies.list \
    REPO_URL=git@github.com:sanbing666/scripts.git \
    REPO_BRANCH=main

RUN set -ex \
    && apk update \
    && apk upgrade \
    && apk add --no-cache tzdata git nodejs moreutils npm curl jq openssh-client python3-dev py3-pip \
    && rm -rf /var/cache/apk/* \
    && ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime \
    && echo "Asia/Shanghai" > /etc/timezone \
    && mkdir -p /root/.ssh \
    && echo -e $KEY > /root/.ssh/id_rsa \
    && chmod 600 /root/.ssh/id_rsa \
    && ssh-keyscan github.com > /root/.ssh/known_hosts \
    && git clone -b $REPO_BRANCH $REPO_URL /scripts \
    && cd /scripts \
    && mkdir logs \
    && npm install \
    && cp /scripts/docker/docker_entrypoint.sh /usr/local/bin \
    && chmod +x /usr/local/bin/docker_entrypoint.sh

WORKDIR /scripts

ENTRYPOINT ["docker_entrypoint.sh"]

CMD [ "crond" ]
